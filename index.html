<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Binary Cross‑Count Grid Puzzle</title>
<style>
  :root {
    --cell: 64px; /* cell size */
    --gap: 15px;   /* grid gap */
    --bg: #0d1117;
    --panel: #111827;
    --ink: #e5e7eb;
    --accent: #60a5fa;
    --ok: #34d399;
    --warn: #f59e0b;
    --bad: #ef4444;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    background: radial-gradient(1200px 600px at 25% -10%, #1f2937, var(--bg));
    color: var(--ink);
  }
  header { padding: 16px 20px; display:flex; gap:16px; align-items:center; flex-wrap:wrap; }
  header h1 { font-size: 18px; font-weight: 700; margin: 0 8px 0 0; letter-spacing:.3px; }
  .controls { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .controls label { font-size: 13px; opacity:.9; }
  button, input, select { 
    background:#0b1220; color:var(--ink); border:1px solid #243b55; border-radius:10px;
    padding:10px 12px; font-weight:600; letter-spacing:.2px; cursor:pointer; 
  }
  button:hover { border-color:#3b82f6; box-shadow:0 0 0 2px #1f2a44 inset; }
  .pill { border-radius:999px; }
  .wrap { display:flex; gap:20px; padding:0 20px 24px; }
  .board-wrap { position: relative; background: #0a0f19; border:1px solid #1f2a44; border-radius:18px; padding:16px; box-shadow: 0 20px 60px rgba(0,0,0,.4) inset, 0 10px 40px rgba(0,0,0,.25); }
  .board { position: relative; display:grid; grid-template-columns: repeat(var(--cols), var(--cell)); grid-template-rows: repeat(var(--rows), var(--cell)); gap: var(--gap); }
  .cell { 
    width: var(--cell); height: var(--cell); display:grid; place-items:center; 
    background: #0d1726; border:1px solid #1f2a44; border-radius:12px; 
    font-size: 26px; font-weight:800; color:#94a3b8; user-select:none; 
    transition: transform .05s ease, background .2s, color .2s, border-color .2s;
  }
  .cell:hover { transform: translateY(-1px); border-color:#334e79; }
  .cell[data-val="0"] { color:#7dd3fc; }
  .cell[data-val="1"] { color:#f472b6; }

  /* Vertex clues overlay (interior intersections) */
  .overlay { position:absolute; inset:0; pointer-events:none; }
  .clue { position:absolute; width: var(--gap); height: var(--gap); margin-left: calc(var(--gap) * -0.5); margin-top: calc(var(--gap) * -0.5);
          display:grid; place-items:center; font-weight: 900; font-size: 14px;
          border-radius: 10px; background: rgba(15,23,42,.8); border:1px solid #1f2a44;
          color:#93c5fd; text-shadow: 0 1px 0 rgba(0,0,0,.5);
          pointer-events:none;}
  .clue.good { background: rgba(16,185,129,.15); color: var(--ok); border-color:#065f46; }
  .clue.bad  { background: rgba(239,68,68,.15); color: var(--bad); border-color:#7f1d1d; }
  .clue.done.good { box-shadow: 0 0 0 2px rgba(52,211,153,.25); }

  .status { min-width:260px; background:#0a1220; border:1px solid #1f2a44; border-radius:14px; padding:12px 14px; }
  .status b { color: var(--ok); }
  .toast { position:fixed; left:50%; bottom:24px; transform:translateX(-50%); 
           background:#0b1220; border:1px solid #1f2a44; padding:12px 16px; border-radius:12px; 
           box-shadow:0 10px 30px rgba(0,0,0,.4); display:none; }
  .toast.show { display:block; animation: pop .35s ease; }
  @keyframes pop { from { transform:translateX(-50%) translateY(6px); opacity:.0 } to { transform:translateX(-50%) translateY(0); opacity:1 } }
  .legend { font-size:12px; color:#9ca3af; }
</style>
</head>
<body>
  <header>
    <h1>Binary Cross‑Count Grid</h1>
    <div class="controls">
      <label>Rows <input id="rows" type="number" min="2" max="12" value="4"></label>
      <label>Cols <input id="cols" type="number" min="2" max="12" value="6"></label>
      <button id="new" class="pill">New Puzzle</button>
      <button id="reveal">Reveal</button>
      <button id="clear">Clear</button>
      <label><input id="autocheck" type="checkbox" checked> Auto‑check</label>
    </div>
  </header>

  <div class="wrap">
    <div class="board-wrap">
      <div id="board" class="board"></div>
      <div id="overlay" class="overlay"></div>
    </div>
    </div>
  </div>

  <div id="toast" class="toast">✅ Puzzle solved! Great job.</div>

<script>
(function(){
  const boardEl = document.getElementById('board');
  const overlayEl = document.getElementById('overlay');
  const toast = document.getElementById('toast');
  const rowsInput = document.getElementById('rows');
  const colsInput = document.getElementById('cols');

  let R = 4, C = 6;
  let solution = [];     // R x C array of 0/1
  let state = [];        // R x C array of -1/0/1  (-1 = empty)
  let clues = [];        // (R-1) x (C-1) array of 0..4

  function randSolution(){
    const s = Array.from({length:R},()=>Array.from({length:C},()=>Math.random()<0.5?0:1));
    return s;
  }
  function computeClues(sol){
    const cl = Array.from({length:R-1},()=>Array(C-1).fill(0));
    for(let r=0;r<R-1;r++){
      for(let c=0;c<C-1;c++){
        cl[r][c] = sol[r][c] + sol[r+1][c] + sol[r][c+1] + sol[r+1][c+1];
      }
    }
    return cl;
  }
  function buildBoard(){
    boardEl.style.setProperty('--rows', R);
    boardEl.style.setProperty('--cols', C);
    boardEl.innerHTML='';
    overlayEl.innerHTML='';

    for(let r=0;r<R;r++){
      for(let c=0;c<C;c++){
        const cell=document.createElement('div');
        cell.className='cell';
        cell.dataset.r=r; cell.dataset.c=c; cell.dataset.val='';
        cell.addEventListener('click', ()=>{
          const v = state[r][c];
          const nv = v===-1?0:(v===0?1:-1);
          setCell(r,c,nv);
          if(document.getElementById('autocheck').checked) updateClues();
          checkWin();
        });
        cell.addEventListener('contextmenu', (e)=>{ e.preventDefault(); setCell(r,c,-1); updateClues(); });
        boardEl.appendChild(cell);
      }
    }

    // place interior vertex clues
    const styles = getComputedStyle(document.documentElement);
    const cellSize = parseInt(styles.getPropertyValue('--cell'));
    const gap = parseInt(styles.getPropertyValue('--gap'));
    const step = cellSize + gap;
    for(let vr=1; vr<R; vr++){
      for(let vc=1; vc<C; vc++){
        const clue=document.createElement('div');
        clue.className='clue';
        const x = vc*cellSize + (vc-0.5)*gap;
        const y = vr*cellSize + (vr-0.5)*gap;
        clue.style.left = `${x}px`;
        clue.style.top  = `${y}px`;
        clue.dataset.vr=vr-1; clue.dataset.vc=vc-1;
        overlayEl.appendChild(clue);
      }
    }
  }

  function setCell(r,c,v){
    state[r][c]=v;
    const idx = r*C + c;
    const el = boardEl.children[idx];
    el.dataset.val = v===-1?'' : String(v);
    el.textContent = v===-1?'' : String(v);
  }

  function updateClues(){
    const children = overlayEl.children;
    for(const el of children){
      const r = parseInt(el.dataset.vr), c = parseInt(el.dataset.vc);
      const tgt = clues[r][c];
      const vals = [state[r][c], state[r+1][c], state[r][c+1], state[r+1][c+1]];
      const ones = vals.filter(v=>v===1).length;
      const undecided = vals.some(v=>v===-1);
      el.textContent = tgt;
      el.classList.remove('good','bad','done');
      if(ones>tgt){ el.classList.add('bad'); }
      else if(!undecided && ones===tgt){ el.classList.add('good','done'); }
      else if(ones===tgt){ el.classList.add('good'); }
    }
  }

  function checkWin(){
    // Victory when all cells decided AND every clue satisfied exactly
    const decided = state.every(row=>row.every(v=>v!==-1));
    if(!decided) return;
    // Quick all-clues pass
    for(let r=0;r<R-1;r++){
      for(let c=0;c<C-1;c++){
        const vals=[state[r][c],state[r+1][c],state[r][c+1],state[r+1][c+1]];
        const ones=vals.filter(v=>v===1).length;
        if(ones!==clues[r][c]) return; // not solved yet
      }
    }
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'), 2000);
  }

  function newPuzzle(){
    R = Math.max(2, Math.min(12, parseInt(rowsInput.value||4)));
    C = Math.max(2, Math.min(12, parseInt(colsInput.value||6)));
    solution = randSolution();
    clues = computeClues(solution);
    state = Array.from({length:R},()=>Array(C).fill(-1));
    buildBoard();
    updateClues();
  }

  function reveal(){
    for(let r=0;r<R;r++) for(let c=0;c<C;c++) setCell(r,c,solution[r][c]);
    updateClues();
    checkWin();
  }

  function clearBoard(){
    for(let r=0;r<R;r++) for(let c=0;c<C;c++) setCell(r,c,-1);
    updateClues();
  }

  // Hook up controls
  document.getElementById('new').addEventListener('click', newPuzzle);
  document.getElementById('reveal').addEventListener('click', reveal);
  document.getElementById('clear').addEventListener('click', clearBoard);

  // Init
  newPuzzle();
})();
</script>
</body>
</html>
